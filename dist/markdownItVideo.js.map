{"version":3,"file":"markdownItVideo.js","sources":["../lib/index.js"],"sourcesContent":["// Process @[youtube](youtubeVideoID)\n// Process @[vimeo](vimeoVideoID)\n// Process @[vine](vineVideoID)\n// Process @[prezi](preziID)\n// Process @[osf](guid)\n// Process @[local](url)\n\nconst ytRegex = /^.*((youtu.be\\/)|(v\\/)|(\\/u\\/\\w\\/)|(embed\\/)|(watch\\?))\\??v?=?([^#&?]*).*/;\nfunction youtubeParser(url) {\n  const match = url.match(ytRegex);\n  return match && match[7].length === 11 ? match[7] : url;\n}\n\n/* eslint-disable max-len */\nconst vimeoRegex = /(?:http:|https:)?\\/\\/(?:www\\.|player\\.)?vimeo.com\\/(?:channels\\/(?:\\w+\\/)?|groups\\/([^/]*)\\/videos\\/|album\\/(\\d+)\\/video\\/|video\\/|)(\\d+)/;\n/* eslint-enable max-len */\nfunction vimeoParser(url) {\n  const match = url.match(vimeoRegex);\n  return match && typeof match[3] === 'string' ? match[3] : url;\n}\n\nconst vineRegex = /^http(?:s?):\\/\\/(?:www\\.)?vine\\.co\\/v\\/([a-zA-Z0-9]{1,13}).*/;\nfunction vineParser(url) {\n  const match = url.match(vineRegex);\n  return match && match[1].length === 11 ? match[1] : url;\n}\n\nconst preziRegex = /^https:\\/\\/prezi.com\\/(.[^/]+)/;\nfunction preziParser(url) {\n  const match = url.match(preziRegex);\n  return match ? match[1] : url;\n}\n\n// TODO: Write regex for staging and local servers.\nconst mfrRegex = /^http(?:s?):\\/\\/(?:www\\.)?mfr\\.osf\\.io\\/render\\?url=http(?:s?):\\/\\/osf\\.io\\/([a-zA-Z0-9]{1,5})\\/\\?action=download/;\nfunction mfrParser(url) {\n  const match = url.match(mfrRegex);\n  return match ? match[1] : url;\n}\n\n\nconst EMBED_REGEX = /@\\[([a-zA-Z].+)]\\([\\s]*(.*?)[\\s]*[)]/im;\n\nfunction videoEmbed(md, options) {\n  function videoReturn(state, silent) {\n    let serviceEnd;\n    let serviceStart;\n    let token;\n    let videoID;\n    let theState = state;\n    const oldPos = state.pos;\n\n    if (state.src.charCodeAt(oldPos) !== 0x40/* @ */ ||\n      state.src.charCodeAt(oldPos + 1) !== 0x5B/* [ */) {\n      return false;\n    }\n\n    const match = EMBED_REGEX.exec(state.src.slice(state.pos, state.src.length));\n\n    if (!match || match.length < 3) {\n      return false;\n    }\n\n    const service = match[1];\n    videoID = match[2];\n    const serviceLower = service.toLowerCase();\n\n    if (serviceLower === 'youtube') {\n      videoID = youtubeParser(videoID);\n    } else if (serviceLower === 'vimeo') {\n      videoID = vimeoParser(videoID);\n    } else if (serviceLower === 'vine') {\n      videoID = vineParser(videoID);\n    } else if (serviceLower === 'prezi') {\n      videoID = preziParser(videoID);\n    } else if (serviceLower === 'osf') {\n      videoID = mfrParser(videoID);\n    } else if (serviceLower === 'local') {\n      // videoID = videoID;\n    } else if (!options[serviceLower]) {\n      return false;\n    }\n\n    // If the videoID field is empty, regex currently make it the close parenthesis.\n    if (videoID === ')') {\n      videoID = '';\n    }\n\n    serviceStart = oldPos + 2;\n    serviceEnd = md.helpers.parseLinkLabel(state, oldPos + 1, false);\n\n    //\n    // We found the end of the link, and know for a fact it's a valid link;\n    // so all that's left to do is to call tokenizer.\n    //\n    if (!silent) {\n      theState.pos = serviceStart;\n      theState.service = theState.src.slice(serviceStart, serviceEnd);\n      const newState = new theState.md.inline.State(service, theState.md, theState.env, []);\n      newState.md.inline.tokenize(newState);\n\n      token = theState.push('video', '');\n      token.videoID = videoID;\n      token.service = service;\n      token.url = match[2];\n      token.level = theState.level;\n    }\n\n    theState.pos += theState.src.indexOf(')', theState.pos);\n    return true;\n  }\n\n  return videoReturn;\n}\n\nfunction extractVideoParameters(url) {\n  const parameterMap = new Map();\n  const params = url.replace(/&amp;/gi, '&').split(/[#?&]/);\n\n  if (params.length > 1) {\n    for (let i = 1; i < params.length; i += 1) {\n      const keyValue = params[i].split('=');\n      if (keyValue.length > 1) parameterMap.set(keyValue[0], keyValue[1]);\n    }\n  }\n\n  return parameterMap;\n}\n\nfunction videoUrl(service, videoID, url, options) {\n  switch (service) {\n  case 'youtube': {\n    const parameters = extractVideoParameters(url);\n    if (options.youtube.parameters) {\n      Object.keys(options.youtube.parameters).forEach((key) => {\n        parameters.set(key, options.youtube.parameters[key]);\n      });\n    }\n\n      // Start time parameter can have the format t=0m10s or t=<time_in_seconds> in share URLs,\n      // but in embed URLs the parameter must be called 'start' and time must be in seconds\n    const timeParameter = parameters.get('t');\n    if (timeParameter !== undefined) {\n      let startTime = 0;\n      const timeParts = timeParameter.match(/[0-9]+/g);\n      let j = 0;\n\n      while (timeParts.length > 0) {\n          /* eslint-disable no-restricted-properties */\n        startTime += Number(timeParts.pop()) * Math.pow(60, j);\n          /* eslint-enable no-restricted-properties */\n        j += 1;\n      }\n      parameters.set('start', startTime);\n      parameters.delete('t');\n    }\n\n    parameters.delete('v');\n    parameters.delete('feature');\n    parameters.delete('origin');\n\n    const parameterArray = Array.from(parameters, p => p.join('='));\n    const parameterPos = videoID.indexOf('?');\n\n    let finalUrl = 'https://www.youtube';\n    if (options.youtube.nocookie || url.indexOf('youtube-nocookie.com') > -1) finalUrl += '-nocookie';\n    finalUrl += '.com/embed/' + (parameterPos > -1 ? videoID.substr(0, parameterPos) : videoID);\n    if (parameterArray.length > 0) finalUrl += '?' + parameterArray.join('&');\n    return finalUrl;\n  }\n  case 'vimeo':\n    return 'https://player.vimeo.com/video/' + videoID;\n  case 'vine':\n    return 'https://vine.co/v/' + videoID + '/embed/' + options.vine.embed;\n  case 'prezi':\n    return 'https://prezi.com/embed/' + videoID +\n        '/?bgcolor=ffffff&amp;lock_to_path=0&amp;autoplay=0&amp;autohide_ctrls=0&amp;' +\n        'landing_data=bHVZZmNaNDBIWnNjdEVENDRhZDFNZGNIUE43MHdLNWpsdFJLb2ZHanI5N1lQVHkxSHFxazZ0UUNCRHloSXZROHh3PT0&amp;' +\n        'landing_sign=1kD6c0N6aYpMUS0wxnQjxzSqZlEB8qNFdxtdjYhwSuI';\n  case 'osf':\n    return 'https://mfr.osf.io/render?url=https://osf.io/' + videoID + '/?action=download';\n  case 'local':\n    return videoID;\n  default:\n    return service;\n  }\n}\n\nfunction tokenizeVideo(md, options) {\n  function tokenizeReturn(tokens, idx) {\n    const videoID = md.utils.escapeHtml(tokens[idx].videoID);\n    const service = md.utils.escapeHtml(tokens[idx].service).toLowerCase();\n    let checkUrl = /http(?:s?):\\/\\/(?:www\\.)?[a-zA-Z0-9-:.]{1,}\\/render(?:\\/)?[a-zA-Z0-9.&;?=:%]{1,}url=http(?:s?):\\/\\/[a-zA-Z0-9 -:.]{1,}\\/[a-zA-Z0-9]{1,5}\\/\\?[a-zA-Z0-9.=:%]{1,}/;\n    let num;\n\n    if (service === 'osf' && videoID) {\n      num = Math.random() * 0x10000;\n\n      if (videoID.match(checkUrl)) {\n        return '<div id=\"' + num + '\" class=\"mfr mfr-file\"></div><script>' +\n          '$(document).ready(function () {new mfr.Render(\"' + num + '\", \"' + videoID + '\");' +\n          '    }); </script>';\n      }\n      return '<div id=\"' + num + '\" class=\"mfr mfr-file\"></div><script>' +\n        '$(document).ready(function () {new mfr.Render(\"' + num + '\", \"https://mfr.osf.io/' +\n        'render?url=https://osf.io/' + videoID + '/?action=download%26mode=render\");' +\n        '    }); </script>';\n    }\n\n    if (service === 'local' && videoID) {\n      const localPlayerAttrs = [];\n\n      const keys = Object.keys(options[service]);\n      const values = Object.values(options[service]);\n\n      for (let i = 0; i < keys.length; i += 1) {\n        localPlayerAttrs.push(keys[i] + '=\"' + values[i] + '\"');\n      }\n      return '<video ' + localPlayerAttrs.join(' ') + '><source src=\"' + videoID + '\" type=\"video/webm\" /></video>';\n    }\n\n    return videoID === '' ? '' :\n      '<div class=\"embed-responsive embed-responsive-16by9\"><iframe class=\"embed-responsive-item ' +\n      service + '-player\" type=\"text/html\" width=\"' + (options[service].width) +\n      '\" height=\"' + (options[service].height) +\n      '\" src=\"' + options.url(service, videoID, tokens[idx].url, options) +\n      '\" frameborder=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>';\n  }\n\n  return tokenizeReturn;\n}\n\nconst defaults = {\n  url: videoUrl,\n  youtube: { width: 640, height: 390, nocookie: false },\n  vimeo: { width: 500, height: 281 },\n  vine: { width: 600, height: 600, embed: 'simple' },\n  prezi: { width: 550, height: 400 },\n  osf: { width: '100%', height: '100%' },\n  local: { controls: true, allowfullscreen: true }\n};\n\nexport default function videoPlugin(md, options) {\n  let theOptions = options;\n  let theMd = md;\n  if (theOptions) {\n    Object.keys(defaults).forEach(function checkForKeys(key) {\n      if (typeof theOptions[key] === 'undefined') {\n        theOptions[key] = defaults[key];\n      }\n    });\n  } else {\n    theOptions = defaults;\n  }\n  theMd.renderer.rules.video = tokenizeVideo(theMd, theOptions);\n  theMd.inline.ruler.before('emphasis', 'video', videoEmbed(theMd, theOptions));\n}\n"],"names":["ytRegex","youtubeParser","url","match","length","vimeoRegex","vimeoParser","vineRegex","vineParser","preziRegex","preziParser","mfrRegex","mfrParser","EMBED_REGEX","videoEmbed","md","options","videoReturn","state","silent","serviceEnd","serviceStart","token","videoID","theState","oldPos","pos","src","charCodeAt","exec","slice","service","serviceLower","toLowerCase","helpers","parseLinkLabel","newState","inline","State","env","tokenize","push","level","indexOf","extractVideoParameters","parameterMap","Map","params","replace","split","i","keyValue","set","videoUrl","parameters","youtube","Object","keys","forEach","key","timeParameter","get","undefined","startTime","timeParts","j","Number","pop","Math","pow","delete","parameterArray","Array","from","p","join","parameterPos","finalUrl","nocookie","substr","vine","embed","tokenizeVideo","tokenizeReturn","tokens","idx","utils","escapeHtml","checkUrl","num","random","localPlayerAttrs","values","width","height","defaults","vimeo","prezi","osf","local","controls","allowfullscreen","videoPlugin","theOptions","theMd","checkForKeys","renderer","rules","video","ruler","before"],"mappings":"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"}