{"version":3,"file":"markdownItBlockEmbed.mjs","sources":["../lib/services/VideoServiceBase.js","../lib/services/YouTubeService.js","../lib/services/VimeoService.js","../lib/services/VineService.js","../lib/services/PreziService.js","../lib/services/TwitterService.js","../lib/services/FacebookService.js","../lib/services/GalleryService.js","../lib/services/MediaService.js","../lib/PluginEnvironment.js","../lib/renderer.js","../lib/tokenizer.js","../lib/index.js"],"sourcesContent":["// Copyright (c) Rotorz Limited and portions by original markdown-it-video authors\n// Licensed under the MIT license. See LICENSE file in the project root.\n\n\n\nfunction defaultUrlFilter(url, _videoID, _serviceName, _options) {\n  return url;\n}\n\n\nclass VideoServiceBase {\n\n  constructor(name, options, env) {\n    this.name = name;\n    this.options = Object.assign(this.getDefaultOptions(), options);\n    this.env = env;\n  }\n\n  getDefaultOptions() {\n    return {};\n  }\n\n  extractVideoID(reference) {\n    return reference;\n  }\n\n  getVideoUrl(_videoID) {\n    throw new Error('not implemented');\n  }\n\n  getFilteredVideoUrl(videoID) {\n    let filterUrlDelegate = typeof this.env.options.filterUrl === 'function'\n      ? this.env.options.filterUrl\n      : defaultUrlFilter;\n    let videoUrl = this.getVideoUrl(videoID);\n    return filterUrlDelegate(videoUrl, this.name, videoID, this.env.options);\n  }\n\n  getEmbedCode(videoID, videoDimensionsInfo, options = {}) {\n    let containerClassNames = [ ];\n    if (this.env.options.containerClassName) {\n      containerClassNames.push(this.env.options.containerClassName);\n    }\n    // config for 'viewport' element\n    const mediaViewportClassName = `${this.env.options.containerClassName}__viewport`;\n    let mediaViewportExists = false;\n    const mediaViewportAttributeList = [];\n\n    let escapedServiceName = this.env.md.utils.escapeHtml(this.name);\n    containerClassNames.push(this.env.options.serviceClassPrefix + escapedServiceName);\n\n    let iframeAttributeList = [];\n    iframeAttributeList.push([ 'type', 'text/html' ]);\n    iframeAttributeList.push([ 'src', this.getFilteredVideoUrl(videoID) ]);\n    iframeAttributeList.push([ 'frameborder', 0 ]);\n\n    // collect default player dimensions from config and allow override from player instance, if available\n    let playerWidth = videoDimensionsInfo.Width || this.options.width;\n    let playerHeight = videoDimensionsInfo.Height || this.options.height;\n    // ouptut width and height if we are configured to do so (and values are valid)\n    if (this.env.options.outputPlayerSize === true && (playerWidth || playerHeight)) {\n      if (playerWidth !== undefined && playerWidth !== null) {\n        iframeAttributeList.push([ 'width', playerWidth ]);\n      }\n      if (playerHeight !== undefined && playerHeight !== null) {\n        iframeAttributeList.push([ 'height', playerHeight ]);\n      }\n    } else if (this.env.options.outputPlayerAspectRatio === true) {\n      // output aspect ratio on media viewport element if we are configured to do so\n      // get explicit aspect ratio\n      let aspectRatio = videoDimensionsInfo.AspectRatio;\n      if (!aspectRatio && playerWidth && playerHeight) {\n        // calculate aspect ratio from dimensions\n        aspectRatio = (playerHeight / playerWidth) * 100;\n      }\n      // only proceed if we have aspect ratio data\n      if (aspectRatio) {\n        // need extra container\n        mediaViewportExists = true;\n        // aspect ratio is achieved with padding and must go hand-in-hand with other styles (e.g. absolute positioning)\n        mediaViewportAttributeList.push([ 'style', `padding-top: ${aspectRatio}%` ]);\n      }\n    }\n\n    if (this.env.options.allowFullScreen === true) {\n      iframeAttributeList.push([ 'webkitallowfullscreen' ]);\n      iframeAttributeList.push([ 'mozallowfullscreen' ]);\n      iframeAttributeList.push([ 'allowfullscreen' ]);\n    }\n\n    const instanceOptions = Object.assign({}, this.options, options);\n    // console.log();\n    Object.entries(instanceOptions).forEach(el => {\n      iframeAttributeList.push(el);\n      if (el[0] === 'class') {\n        containerClassNames.push(el[1]);\n      }\n    });\n\n    let iframeAttributes = iframeAttributeList\n      .map(pair =>\n        pair[1] !== undefined\n          ? `${pair[0]}=\"${pair[1]}\"`\n          : pair[0]\n      )\n      .join(' ');\n\n    const mediaViewportAttributes = mediaViewportAttributeList\n      .map(pair =>\n        pair[1] !== undefined\n          ? `${pair[0]}=\"${pair[1]}\"`\n          : pair[0]\n      )\n      .join(' ');\n\n    return `<div class=\"${containerClassNames.join(' ')}\">`\n            + (mediaViewportExists ? `<div class=\"${mediaViewportClassName}\" ${mediaViewportAttributes}>` : '')\n            + `<iframe ${iframeAttributes}></iframe>`\n           + (mediaViewportExists ? '</div>' : '')\n         + '</div>\\n';\n  }\n\n}\n\n\nexport default VideoServiceBase;\n","// Copyright (c) Rotorz Limited and portions by original markdown-it-video authors\n// Licensed under the MIT license. See LICENSE file in the project root.\n\n\nimport VideoServiceBase from './VideoServiceBase.js';\n\n\nclass YouTubeService extends VideoServiceBase {\n\n  getDefaultOptions() {\n    return { width: 640, height: 390 };\n  }\n\n  extractVideoID(reference) {\n    let match = reference.match(/^.*((youtu.be\\/)|(v\\/)|(\\/u\\/\\w\\/)|(embed\\/)|(watch\\?))\\??v?=?([^#&?]*).*/);\n    return match && match[7].length === 11 ? match[7] : reference;\n  }\n\n  getVideoUrl(videoID) {\n    let escapedVideoID = this.env.md.utils.escapeHtml(videoID);\n    return `//www.youtube.com/embed/${escapedVideoID}`;\n  }\n\n}\n\n\nexport default YouTubeService;\n","// Copyright (c) Rotorz Limited and portions by original markdown-it-video authors\n// Licensed under the MIT license. See LICENSE file in the project root.\n\n\nimport VideoServiceBase from './VideoServiceBase.js';\n\n\nclass VimeoService extends VideoServiceBase {\n\n  getDefaultOptions() {\n    return { width: 500, height: 281, isBackground: false };\n  }\n\n  extractVideoID(reference) {\n    let match = reference.match(/https?:\\/\\/(?:www\\.|player\\.)?vimeo.com\\/(?:channels\\/(?:\\w+\\/)?|groups\\/([^/]*)\\/videos\\/|album\\/(\\d+)\\/video\\/|)(\\d+)(?:$|\\/|\\?)/);\n    return match && typeof match[3] === 'string' ? match[3] : reference;\n  }\n\n  getVideoUrl(videoID) {\n    let escapedVideoID = this.env.md.utils.escapeHtml(videoID);\n    // construct vimeo player url\n    let vimeoUrl = `//player.vimeo.com/video/${escapedVideoID}`;\n    // change url to suit options for player\n    if (this.options.isBackground) {\n      // background mode\n      vimeoUrl += '?background=1';\n    }\n    return vimeoUrl;\n  }\n\n}\n\n\nexport default VimeoService;\n","// Copyright (c) Rotorz Limited and portions by original markdown-it-video authors\n// Licensed under the MIT license. See LICENSE file in the project root.\n\n\nimport VideoServiceBase from './VideoServiceBase.js';\n\n\nclass VineService extends VideoServiceBase {\n\n  getDefaultOptions() {\n    return { width: 600, height: 600, embed: 'simple' };\n  }\n\n  extractVideoID(reference) {\n    let match = reference.match(/^http(?:s?):\\/\\/(?:www\\.)?vine\\.co\\/v\\/([a-zA-Z0-9]{1,13}).*/);\n    return match && match[1].length === 11 ? match[1] : reference;\n  }\n\n  getVideoUrl(videoID) {\n    let escapedVideoID = this.env.md.utils.escapeHtml(videoID);\n    let escapedEmbed = this.env.md.utils.escapeHtml(this.options.embed);\n    return `//vine.co/v/${escapedVideoID}/embed/${escapedEmbed}`;\n  }\n\n}\n\n\nexport default VineService;\n","// Copyright (c) Rotorz Limited and portions by original markdown-it-video authors\n// Licensed under the MIT license. See LICENSE file in the project root.\n\n\nimport VideoServiceBase from './VideoServiceBase.js';\n\n\nclass PreziService extends VideoServiceBase {\n\n  getDefaultOptions() {\n    return { width: 550, height: 400 };\n  }\n\n  extractVideoID(reference) {\n    let match = reference.match(/^https:\\/\\/prezi.com\\/(.[^/]+)/);\n    return match ? match[1] : reference;\n  }\n\n  getVideoUrl(videoID) {\n    let escapedVideoID = this.env.md.utils.escapeHtml(videoID);\n    return 'https://prezi.com/embed/' + escapedVideoID\n        + '/?bgcolor=ffffff&amp;lock_to_path=0&amp;autoplay=0&amp;autohide_ctrls=0&amp;'\n        + 'landing_data=bHVZZmNaNDBIWnNjdEVENDRhZDFNZGNIUE43MHdLNWpsdFJLb2ZHanI5N1lQVHkxSHFxazZ0UUNCRHloSXZROHh3PT0&amp;'\n        + 'landing_sign=1kD6c0N6aYpMUS0wxnQjxzSqZlEB8qNFdxtdjYhwSuI';\n  }\n\n}\n\n\nexport default PreziService;\n","// Copyright (c) Rotorz Limited and portions by original markdown-it-video authors\n// Licensed under the MIT license. See LICENSE file in the project root.\n\n\n\nclass TwitterService {\n\n  constructor(name, options, env) {\n    this.name = name;\n    this.options = Object.assign(this.getDefaultOptions(), options);\n    this.env = env;\n  }\n  getDefaultOptions() {\n    return { 'data-lang': 'en', dir: 'ltr' };\n  }\n\n\n  getEmbedCode(videoID, videoDimensionsInfo, options = {}) {\n    let containerClassNames = [];\n    if (this.env.options.containerClassName) {\n      containerClassNames.push(this.env.options.containerClassName);\n    }\n    let escapedServiceName = this.env.md.utils.escapeHtml(this.name);\n    containerClassNames.push(this.env.options.serviceClassPrefix + escapedServiceName);\n\n    let iframeAttributeList = [];\n    // iframeAttributeList.push([ \"src\", `https://twitframe.com/show?url=` + reference ]);\n    const instanceOptions = Object.assign({}, this.options, options);\n    // console.log();\n    Object.entries(instanceOptions).forEach(el => {\n      iframeAttributeList.push(el);\n      if (el[0] === 'class') {\n        containerClassNames.push(el[1]);\n      }\n    });\n\n    let iframeAttributes = iframeAttributeList\n      .map(pair =>\n        pair[1] !== undefined\n          ? `${pair[0]}=\"${pair[1]}\"`\n          : pair[0]\n      )\n      .join(' ');\n\n    return `<div class=\"${containerClassNames.join(' ')}\">`\n      + `<blockquote class=\"twitter-tweet\" ${iframeAttributes}><p lang=\"${instanceOptions['data-lang']}\" dir=\"${instanceOptions.dir}\"><a href=\"${videoID}\"></a></p></blockquote>`\n      + '</div>\\n';\n  }\n\n}\n\n\nexport default TwitterService;\n","// Copyright (c) Rotorz Limited and portions by original markdown-it-video authors\n// Licensed under the MIT license. See LICENSE file in the project root.\n\n\n\nclass FacebookService {\n\n  constructor(name, options, env) {\n    this.name = name;\n\n    this.env = env;\n    this.options = Object.assign(this.getDefaultOptions(), options);\n  }\n\n  getDefaultOptions() {\n    return { width: 500, height: 500 };\n  }\n\n  getEmbedCode(videoID, videoDimensionsInfo, options = {}) {\n\n    let containerClassNames = [];\n    if (this.env.options.containerClassName) {\n      containerClassNames.push(this.env.options.containerClassName);\n    }\n    let escapedServiceName = this.env.md.utils.escapeHtml(this.name);\n    containerClassNames.push(this.env.options.serviceClassPrefix + escapedServiceName);\n\n    let iframeAttributeList = [];\n    iframeAttributeList.push([ 'src', 'https://www.facebook.com/plugins/post.php?href=' + reference ]);\n\n    const instanceOptions = Object.assign({}, this.options, options);\n    // console.log();\n    Object.entries(instanceOptions).forEach(el => {\n      iframeAttributeList.push(el);\n      if (el[0] === 'class') {\n        containerClassNames.push(el[1]);\n      }\n    });\n\n    let iframeAttributes = iframeAttributeList\n      .map(pair =>\n        pair[1] !== undefined\n          ? `${pair[0]}=\"${pair[1]}\"`\n          : pair[0]\n      )\n      .join(' ');\n\n    return `<div class=\"${containerClassNames.join(' ')}\">`\n      + `<iframe ${iframeAttributes}></iframe>`\n      + '</div>\\n';\n  }\n\n}\n\n\nexport default FacebookService;\n","// Copyright (c) Rotorz Limited and portions by original markdown-it-video authors\n// Licensed under the MIT license. See LICENSE file in the project root.\n\n\n\nclass GalleryService {\n\n  constructor(name, options, env) {\n    this.name = name;\n\n    this.env = env;\n    this.options = Object.assign(this.getDefaultOptions(), options);\n  }\n  getDefaultOptions() {\n    return {};\n  }\n\n\n  getEmbedCode(videoID, videoDimensionsInfo, options = {}) {\n\n    let containerClassNames = [];\n    if (this.env.options.containerClassName) {\n      containerClassNames.push(this.env.options.containerClassName);\n    }\n    let escapedServiceName = this.env.md.utils.escapeHtml(this.name);\n    containerClassNames.push(this.env.options.serviceClassPrefix + escapedServiceName);\n\n    let iframeAttributeList = [];\n    // iframeAttributeList.push([ \"src\", `https://www.facebook.com/plugins/post.php?href=` + reference ]);\n\n    const instanceOptions = Object.assign({}, this.options, options);\n    // console.log();\n    Object.entries(instanceOptions).forEach(el => {\n      iframeAttributeList.push(el);\n\n    });\n\n    let iframeAttributes = iframeAttributeList\n      .map(pair =>\n        pair[1] !== undefined\n          ? `${pair[0]}=\"${pair[1]}\"`\n          : pair[0]\n      )\n      .join(' ');\n\n    return `<div class=\"${containerClassNames.join(' ')}\">`\n      + `[gallery id=${videoID} ${iframeAttributes}][/gallery]`\n      + '</div>\\n';\n  }\n\n}\n\n\nexport default GalleryService;\n","// Copyright (c) Rotorz Limited and portions by original markdown-it-video authors\n// Licensed under the MIT license. See LICENSE file in the project root.\n\n\n\nclass MediaService {\n\n  constructor(name, options, env) {\n    this.name = name;\n\n    this.env = env;\n    this.options = Object.assign(this.getDefaultOptions(), options);\n  }\n  getDefaultOptions() {\n    return {};\n  }\n\n\n  getEmbedCode(videoID, videoDimensionsInfo, options = {}) {\n\n    let containerClassNames = [];\n    if (this.env.options.containerClassName) {\n      containerClassNames.push(this.env.options.containerClassName);\n    }\n    let escapedServiceName = this.env.md.utils.escapeHtml(this.name);\n    containerClassNames.push(this.env.options.serviceClassPrefix + escapedServiceName);\n\n    let iframeAttributeList = [];\n    // iframeAttributeList.push([ \"src\", `https://www.facebook.com/plugins/post.php?href=` + reference ]);\n\n    const instanceOptions = Object.assign({}, this.options, options);\n    // console.log();\n    Object.entries(instanceOptions).forEach(el => {\n      iframeAttributeList.push(el);\n      if (el[0] === 'class') {\n        containerClassNames.push(el[1]);\n      }\n    });\n\n    let iframeAttributes = iframeAttributeList\n      .map(pair =>\n        pair[1] !== undefined\n          ? `${pair[0]}=\"${pair[1]}\"`\n          : pair[0]\n      )\n      .join(' ');\n\n    return `<div class=\"${containerClassNames.join(' ')}\">`\n      + `[media id=${videoID} ${iframeAttributes}][/media]`\n      + '</div>\\n';\n  }\n\n}\n\n\nexport default MediaService;\n","// Copyright (c) Rotorz Limited and portions by original markdown-it-video authors\n// Licensed under the MIT license. See LICENSE file in the project root.\n\nimport YouTubeService from './services/YouTubeService.js';\nimport VimeoService from './services/VimeoService.js';\nimport VineService from './services/VineService.js';\nimport PreziService from './services/PreziService.js';\nimport TwitterService from './services/TwitterService.js';\nimport FacebookService from './services/FacebookService.js';\nimport GalleryService from './services/GalleryService.js';\nimport MediaService from './services/MediaService.js';\n\nclass PluginEnvironment {\n\n  constructor(md, options) {\n    this.md = md;\n    this.options = Object.assign(this.getDefaultOptions(), options);\n\n    this._initServices();\n  }\n\n  _initServices() {\n    let defaultServiceBindings = {\n      youtube: YouTubeService,\n      vimeo: VimeoService,\n      vine: VineService,\n      prezi: PreziService,\n      twitter: TwitterService,\n      facebook: FacebookService,\n      gallery: GalleryService,\n      media: MediaService\n    };\n\n    let serviceBindings = Object.assign({}, defaultServiceBindings, this.options.services);\n    let services = {};\n    for (let serviceName of Object.keys(serviceBindings)) {\n      let _serviceClass = serviceBindings[serviceName];\n      services[serviceName] = new _serviceClass(serviceName, this.options[serviceName], this);\n    }\n\n    this.services = services;\n  }\n\n  getDefaultOptions() {\n    return {\n      containerClassName: 'block-embed',\n      serviceClassPrefix: 'block-embed-service-',\n      outputPlayerSize: true,\n      outputPlayerAspectRatio: false,\n      allowInstancePlayerSizeDefinition: false,\n      allowFullScreen: true,\n      filterUrl: null\n    };\n  }\n\n}\n\n\nexport default PluginEnvironment;\n","// Copyright (c) Rotorz Limited and portions by original markdown-it-video authors\n// Licensed under the MIT license. See LICENSE file in the project root.\n\n// eslint-disable-next-line no-unused-vars\nfunction renderer(tokens, idx, options = {}, _env) {\n  let videoToken = tokens[idx];\n\n  let service = videoToken.info.service;\n  let videoID = videoToken.info.videoID;\n  let videoDimensionsInfo = videoToken.info.videoDimensionsInfo;\n\n  let optionsMerged = videoToken.info.serviceOptions;\n\n  return service.getEmbedCode(videoID, videoDimensionsInfo, optionsMerged);\n}\n\nexport default renderer;\n","// Copyright (c) Rotorz Limited and portions by original markdown-it-video authors\n// Licensed under the MIT license. See LICENSE file in the project root.\n\nconst SYNTAX_CHARS = '@[]()'.split('');\nconst SYNTAX_CODES = SYNTAX_CHARS.map(char => char.charCodeAt(0));\n\n\nfunction advanceToSymbol(state, endLine, symbol, pointer) {\n  let maxPos = null;\n  let symbolLine = pointer.line;\n  let symbolIndex = state.src.indexOf(symbol, pointer.pos);\n\n  if (symbolIndex === -1) return false;\n\n  maxPos = state.eMarks[pointer.line];\n  while (symbolIndex >= maxPos) {\n    ++symbolLine;\n    maxPos = state.eMarks[symbolLine];\n\n    if (symbolLine >= endLine) return false;\n  }\n\n  pointer.prevPos = pointer.pos;\n  pointer.pos = symbolIndex;\n  pointer.line = symbolLine;\n  return true;\n}\n\n\nfunction tokenizer(state, startLine, endLine, silent) {\n  let startPos = state.bMarks[startLine] + state.tShift[startLine];\n  let maxPos = state.eMarks[startLine];\n\n  let pointer = { line: startLine, pos: startPos };\n\n  // Block embed must be at start of input or the previous line must be blank.\n  if (startLine !== 0) {\n    let prevLineStartPos = state.bMarks[startLine - 1] + state.tShift[startLine - 1];\n    let prevLineMaxPos = state.eMarks[startLine - 1];\n    if (prevLineMaxPos > prevLineStartPos) return false;\n  }\n\n  // Identify as being a potential block embed.\n  if (maxPos - startPos < 2) return false;\n  if (SYNTAX_CODES[0] !== state.src.charCodeAt(pointer.pos++)) return false;\n\n  // Read service name from within square brackets.\n  if (SYNTAX_CODES[1] !== state.src.charCodeAt(pointer.pos++)) return false;\n  if (!advanceToSymbol(state, endLine, ']', pointer)) return false;\n\n  let tagString = state.src\n    .substr(pointer.prevPos, pointer.pos - pointer.prevPos)\n    .trim()\n    .toLowerCase();\n  let m;\n  let tagOptions = {};\n  let regex = /(\\S+)=[\"']?((?:.(?![\"']?\\s+(?:\\S+)=|[>\"']))+.)[\"']?/g;\n  while ((m = regex.exec(tagString)) !== null) {\n    // This is necessary to avoid infinite loops with zero-width matches\n    if (m.index === regex.lastIndex) {\n      regex.lastIndex++;\n    }\n\n    // The result can be accessed through the `m`-variable.\n    tagOptions[m[1]] = m[2];\n  }\n\n  let serviceName = 'unknown';\n  regex = /(\\S+)\\s*.*/g;\n  while ((m = regex.exec(tagString)) !== null) {\n    // This is necessary to avoid infinite loops with zero-width matches\n    if (m.index === regex.lastIndex) {\n      regex.lastIndex++;\n    }\n\n    // The result can be accessed through the `m`-variable.\n    serviceName = m[1];\n  }\n\n  ++pointer.pos;\n\n  // Lookup service; if unknown, then this is not a known embed!\n  let service = this.services[serviceName];\n  // console.log(service==true);\n  if (!service) return false;\n\n  // Read embed reference from within parenthesis.\n  if (SYNTAX_CODES[3] !== state.src.charCodeAt(pointer.pos++)) return false;\n  if (!advanceToSymbol(state, endLine, ')', pointer)) return false;\n\n  let videoReference = state.src\n    .substr(pointer.prevPos, pointer.pos - pointer.prevPos)\n    .trim();\n\n  ++pointer.pos;\n\n  // Do not recognize as block element when there is trailing text.\n  maxPos = state.eMarks[pointer.line];\n  let trailingText = state.src\n    .substr(pointer.pos, maxPos - pointer.pos)\n    .trim();\n  if (trailingText !== '') return false;\n\n  // Block embed must be at end of input or the next line must be blank.\n  if (endLine !== pointer.line + 1) {\n    let nextLineStartPos = state.bMarks[pointer.line + 1] + state.tShift[pointer.line + 1];\n    let nextLineMaxPos = state.eMarks[pointer.line + 1];\n    if (nextLineMaxPos > nextLineStartPos) return false;\n  }\n\n  if (pointer.line >= endLine) return false;\n\n  if (!silent) {\n    let token = state.push('video', 'div', 0);\n    // object for storing and passing what we know about the player instance dimensions\n    let videoDimensionsInfo = {};\n    // configuration option allows us to parse player size for individual player instances\n    if (this.options.allowInstancePlayerSizeDefinition === true) {\n      const videoReferenceComponents = videoReference.split('##');\n      if (videoReferenceComponents.length > 1) {\n        // first component is url / ID\n        videoReference = videoReferenceComponents[0];\n        // second component is size information\n        // either a width/height or a single aspect ratio value (as height percentage of width)\n        // find if is a string split by 'x' i.e. XXXxYYY\n        const videoDimensionsComponents = videoReferenceComponents[1].split('x');\n        if (videoDimensionsComponents.length === 2) {\n          // should be width and height\n          videoDimensionsInfo.Width = videoDimensionsComponents[0];\n          videoDimensionsInfo.Height = videoDimensionsComponents[1];\n        } else if (videoDimensionsComponents.length === 1) {\n          // should be aspect ratio (assume int)\n          videoDimensionsInfo.AspectRatio = videoDimensionsComponents[0];\n        }\n        // future: detect if more than 2 components for third (currently unused) option...\n      }\n    }\n    token.markup = state.src.slice(startPos, pointer.pos);\n    token.block = true;\n    token.info = {\n      serviceName: serviceName,\n      service: service,\n      videoReference: videoReference,\n      serviceOptions: tagOptions,\n      videoID: service.extractVideoID(videoReference),\n      videoDimensionsInfo: videoDimensionsInfo\n    };\n    token.map = [ startLine, pointer.line + 1 ];\n\n    state.line = pointer.line + 1;\n  }\n\n  return true;\n}\n\n\nexport default tokenizer;\n","// Copyright (c) Rotorz Limited and portions by original markdown-it-video authors\n// Licensed under the MIT license. See LICENSE file in the project root.\n\nimport PluginEnvironment from './PluginEnvironment.js';\nimport renderer from './renderer.js';\nimport tokenizer from './tokenizer.js';\n\n\nfunction setup(md, options) {\n  let env = new PluginEnvironment(md, options);\n\n  md.block.ruler.before('fence', 'embed', tokenizer.bind(env), {\n    alt: [ 'paragraph', 'reference', 'blockquote', 'list' ]\n  });\n  md.renderer.rules.embed = renderer.bind(env);\n}\n\n\nexport default setup;\n"],"names":["defaultUrlFilter","url","_videoID","_serviceName","_options","VideoServiceBase","constructor","name","options","env","Object","assign","getDefaultOptions","extractVideoID","reference","getVideoUrl","Error","getFilteredVideoUrl","videoID","filterUrlDelegate","filterUrl","videoUrl","getEmbedCode","videoDimensionsInfo","containerClassNames","containerClassName","push","mediaViewportClassName","mediaViewportExists","mediaViewportAttributeList","escapedServiceName","md","utils","escapeHtml","serviceClassPrefix","iframeAttributeList","playerWidth","Width","width","playerHeight","Height","height","outputPlayerSize","undefined","outputPlayerAspectRatio","aspectRatio","AspectRatio","allowFullScreen","instanceOptions","entries","forEach","el","iframeAttributes","map","pair","join","mediaViewportAttributes","YouTubeService","match","length","escapedVideoID","VimeoService","isBackground","vimeoUrl","VineService","embed","escapedEmbed","PreziService","TwitterService","dir","FacebookService","GalleryService","MediaService","PluginEnvironment","_initServices","defaultServiceBindings","youtube","vimeo","vine","prezi","twitter","facebook","gallery","media","serviceBindings","services","serviceName","keys","_serviceClass","allowInstancePlayerSizeDefinition","renderer","tokens","idx","_env","videoToken","service","info","optionsMerged","serviceOptions","SYNTAX_CHARS","split","SYNTAX_CODES","char","charCodeAt","advanceToSymbol","state","endLine","symbol","pointer","maxPos","symbolLine","line","symbolIndex","src","indexOf","pos","eMarks","prevPos","tokenizer","startLine","silent","startPos","bMarks","tShift","prevLineStartPos","prevLineMaxPos","tagString","substr","trim","toLowerCase","m","tagOptions","regex","exec","index","lastIndex","videoReference","trailingText","nextLineStartPos","nextLineMaxPos","token","videoReferenceComponents","videoDimensionsComponents","markup","slice","block","setup","ruler","before","bind","alt","rules"],"mappings":"AAAA;AACA;AAIA,SAASA,gBAAT,CAA0BC,GAA1B,EAA+BC,QAA/B,EAAyCC,YAAzC,EAAuDC,QAAvD,EAAiE;AAC/D,SAAOH,GAAP;AACD;;AAGD,MAAMI,gBAAN,CAAuB;AAErBC,EAAAA,WAAW,CAACC,IAAD,EAAOC,OAAP,EAAgBC,GAAhB,EAAqB;AAC9B,SAAKF,IAAL,GAAYA,IAAZ;AACA,SAAKC,OAAL,GAAeE,MAAM,CAACC,MAAP,CAAc,KAAKC,iBAAL,EAAd,EAAwCJ,OAAxC,CAAf;AACA,SAAKC,GAAL,GAAWA,GAAX;AACD;;AAEDG,EAAAA,iBAAiB,GAAG;AAClB,WAAO,EAAP;AACD;;AAEDC,EAAAA,cAAc,CAACC,SAAD,EAAY;AACxB,WAAOA,SAAP;AACD;;AAEDC,EAAAA,WAAW,CAACb,QAAD,EAAW;AACpB,UAAM,IAAIc,KAAJ,CAAU,iBAAV,CAAN;AACD;;AAEDC,EAAAA,mBAAmB,CAACC,OAAD,EAAU;AAC3B,QAAIC,iBAAiB,GAAG,OAAO,KAAKV,GAAL,CAASD,OAAT,CAAiBY,SAAxB,KAAsC,UAAtC,GACpB,KAAKX,GAAL,CAASD,OAAT,CAAiBY,SADG,GAEpBpB,gBAFJ;AAGA,QAAIqB,QAAQ,GAAG,KAAKN,WAAL,CAAiBG,OAAjB,CAAf;AACA,WAAOC,iBAAiB,CAACE,QAAD,EAAW,KAAKd,IAAhB,EAAsBW,OAAtB,EAA+B,KAAKT,GAAL,CAASD,OAAxC,CAAxB;AACD;;AAEDc,EAAAA,YAAY,CAACJ,OAAD,EAAUK,mBAAV,EAA+Bf,OAAO,GAAG,EAAzC,EAA6C;AACvD,QAAIgB,mBAAmB,GAAG,EAA1B;;AACA,QAAI,KAAKf,GAAL,CAASD,OAAT,CAAiBiB,kBAArB,EAAyC;AACvCD,MAAAA,mBAAmB,CAACE,IAApB,CAAyB,KAAKjB,GAAL,CAASD,OAAT,CAAiBiB,kBAA1C;AACD,KAJsD;;;AAMvD,UAAME,sBAAsB,GAAI,GAAE,KAAKlB,GAAL,CAASD,OAAT,CAAiBiB,kBAAmB,YAAtE;AACA,QAAIG,mBAAmB,GAAG,KAA1B;AACA,UAAMC,0BAA0B,GAAG,EAAnC;AAEA,QAAIC,kBAAkB,GAAG,KAAKrB,GAAL,CAASsB,EAAT,CAAYC,KAAZ,CAAkBC,UAAlB,CAA6B,KAAK1B,IAAlC,CAAzB;AACAiB,IAAAA,mBAAmB,CAACE,IAApB,CAAyB,KAAKjB,GAAL,CAASD,OAAT,CAAiB0B,kBAAjB,GAAsCJ,kBAA/D;AAEA,QAAIK,mBAAmB,GAAG,EAA1B;AACAA,IAAAA,mBAAmB,CAACT,IAApB,CAAyB,CAAE,MAAF,EAAU,WAAV,CAAzB;AACAS,IAAAA,mBAAmB,CAACT,IAApB,CAAyB,CAAE,KAAF,EAAS,KAAKT,mBAAL,CAAyBC,OAAzB,CAAT,CAAzB;AACAiB,IAAAA,mBAAmB,CAACT,IAApB,CAAyB,CAAE,aAAF,EAAiB,CAAjB,CAAzB,EAhBuD;;AAmBvD,QAAIU,WAAW,GAAGb,mBAAmB,CAACc,KAApB,IAA6B,KAAK7B,OAAL,CAAa8B,KAA5D;AACA,QAAIC,YAAY,GAAGhB,mBAAmB,CAACiB,MAApB,IAA8B,KAAKhC,OAAL,CAAaiC,MAA9D,CApBuD;;AAsBvD,QAAI,KAAKhC,GAAL,CAASD,OAAT,CAAiBkC,gBAAjB,KAAsC,IAAtC,KAA+CN,WAAW,IAAIG,YAA9D,CAAJ,EAAiF;AAC/E,UAAIH,WAAW,KAAKO,SAAhB,IAA6BP,WAAW,KAAK,IAAjD,EAAuD;AACrDD,QAAAA,mBAAmB,CAACT,IAApB,CAAyB,CAAE,OAAF,EAAWU,WAAX,CAAzB;AACD;;AACD,UAAIG,YAAY,KAAKI,SAAjB,IAA8BJ,YAAY,KAAK,IAAnD,EAAyD;AACvDJ,QAAAA,mBAAmB,CAACT,IAApB,CAAyB,CAAE,QAAF,EAAYa,YAAZ,CAAzB;AACD;AACF,KAPD,MAOO,IAAI,KAAK9B,GAAL,CAASD,OAAT,CAAiBoC,uBAAjB,KAA6C,IAAjD,EAAuD;AAC5D;AACA;AACA,UAAIC,WAAW,GAAGtB,mBAAmB,CAACuB,WAAtC;;AACA,UAAI,CAACD,WAAD,IAAgBT,WAAhB,IAA+BG,YAAnC,EAAiD;AAC/C;AACAM,QAAAA,WAAW,GAAIN,YAAY,GAAGH,WAAhB,GAA+B,GAA7C;AACD,OAP2D;;;AAS5D,UAAIS,WAAJ,EAAiB;AACf;AACAjB,QAAAA,mBAAmB,GAAG,IAAtB,CAFe;;AAIfC,QAAAA,0BAA0B,CAACH,IAA3B,CAAgC,CAAE,OAAF,EAAY,gBAAemB,WAAY,GAAvC,CAAhC;AACD;AACF;;AAED,QAAI,KAAKpC,GAAL,CAASD,OAAT,CAAiBuC,eAAjB,KAAqC,IAAzC,EAA+C;AAC7CZ,MAAAA,mBAAmB,CAACT,IAApB,CAAyB,CAAE,uBAAF,CAAzB;AACAS,MAAAA,mBAAmB,CAACT,IAApB,CAAyB,CAAE,oBAAF,CAAzB;AACAS,MAAAA,mBAAmB,CAACT,IAApB,CAAyB,CAAE,iBAAF,CAAzB;AACD;;AAED,UAAMsB,eAAe,GAAGtC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB,KAAKH,OAAvB,EAAgCA,OAAhC,CAAxB,CApDuD;;AAsDvDE,IAAAA,MAAM,CAACuC,OAAP,CAAeD,eAAf,EAAgCE,OAAhC,CAAwCC,EAAE,IAAI;AAC5ChB,MAAAA,mBAAmB,CAACT,IAApB,CAAyByB,EAAzB;;AACA,UAAIA,EAAE,CAAC,CAAD,CAAF,KAAU,OAAd,EAAuB;AACrB3B,QAAAA,mBAAmB,CAACE,IAApB,CAAyByB,EAAE,CAAC,CAAD,CAA3B;AACD;AACF,KALD;AAOA,QAAIC,gBAAgB,GAAGjB,mBAAmB,CACvCkB,GADoB,CAChBC,IAAI,IACPA,IAAI,CAAC,CAAD,CAAJ,KAAYX,SAAZ,GACK,GAAEW,IAAI,CAAC,CAAD,CAAI,KAAIA,IAAI,CAAC,CAAD,CAAI,GAD3B,GAEIA,IAAI,CAAC,CAAD,CAJW,EAMpBC,IANoB,CAMf,GANe,CAAvB;AAQA,UAAMC,uBAAuB,GAAG3B,0BAA0B,CACvDwB,GAD6B,CACzBC,IAAI,IACPA,IAAI,CAAC,CAAD,CAAJ,KAAYX,SAAZ,GACK,GAAEW,IAAI,CAAC,CAAD,CAAI,KAAIA,IAAI,CAAC,CAAD,CAAI,GAD3B,GAEIA,IAAI,CAAC,CAAD,CAJoB,EAM7BC,IAN6B,CAMxB,GANwB,CAAhC;AAQA,WAAQ,eAAc/B,mBAAmB,CAAC+B,IAApB,CAAyB,GAAzB,CAA8B,IAA7C,IACI3B,mBAAmB,GAAI,eAAcD,sBAAuB,KAAI6B,uBAAwB,GAArE,GAA0E,EADjG,IAEI,WAAUJ,gBAAiB,YAF/B,IAGGxB,mBAAmB,GAAG,QAAH,GAAc,EAHpC,IAIA,UAJP;AAKD;;AA9GoB;;ACVvB;AACA;AAMA,MAAM6B,cAAN,SAA6BpD,gBAA7B,CAA8C;AAE5CO,EAAAA,iBAAiB,GAAG;AAClB,WAAO;AAAE0B,MAAAA,KAAK,EAAE,GAAT;AAAcG,MAAAA,MAAM,EAAE;AAAtB,KAAP;AACD;;AAED5B,EAAAA,cAAc,CAACC,SAAD,EAAY;AACxB,QAAI4C,KAAK,GAAG5C,SAAS,CAAC4C,KAAV,CAAgB,2EAAhB,CAAZ;AACA,WAAOA,KAAK,IAAIA,KAAK,CAAC,CAAD,CAAL,CAASC,MAAT,KAAoB,EAA7B,GAAkCD,KAAK,CAAC,CAAD,CAAvC,GAA6C5C,SAApD;AACD;;AAEDC,EAAAA,WAAW,CAACG,OAAD,EAAU;AACnB,QAAI0C,cAAc,GAAG,KAAKnD,GAAL,CAASsB,EAAT,CAAYC,KAAZ,CAAkBC,UAAlB,CAA6Bf,OAA7B,CAArB;AACA,WAAQ,2BAA0B0C,cAAe,EAAjD;AACD;;AAd2C;;ACP9C;AACA;AAMA,MAAMC,YAAN,SAA2BxD,gBAA3B,CAA4C;AAE1CO,EAAAA,iBAAiB,GAAG;AAClB,WAAO;AAAE0B,MAAAA,KAAK,EAAE,GAAT;AAAcG,MAAAA,MAAM,EAAE,GAAtB;AAA2BqB,MAAAA,YAAY,EAAE;AAAzC,KAAP;AACD;;AAEDjD,EAAAA,cAAc,CAACC,SAAD,EAAY;AACxB,QAAI4C,KAAK,GAAG5C,SAAS,CAAC4C,KAAV,CAAgB,oIAAhB,CAAZ;AACA,WAAOA,KAAK,IAAI,OAAOA,KAAK,CAAC,CAAD,CAAZ,KAAoB,QAA7B,GAAwCA,KAAK,CAAC,CAAD,CAA7C,GAAmD5C,SAA1D;AACD;;AAEDC,EAAAA,WAAW,CAACG,OAAD,EAAU;AACnB,QAAI0C,cAAc,GAAG,KAAKnD,GAAL,CAASsB,EAAT,CAAYC,KAAZ,CAAkBC,UAAlB,CAA6Bf,OAA7B,CAArB,CADmB;;AAGnB,QAAI6C,QAAQ,GAAI,4BAA2BH,cAAe,EAA1D,CAHmB;;AAKnB,QAAI,KAAKpD,OAAL,CAAasD,YAAjB,EAA+B;AAC7B;AACAC,MAAAA,QAAQ,IAAI,eAAZ;AACD;;AACD,WAAOA,QAAP;AACD;;AArByC;;ACP5C;AACA;AAMA,MAAMC,WAAN,SAA0B3D,gBAA1B,CAA2C;AAEzCO,EAAAA,iBAAiB,GAAG;AAClB,WAAO;AAAE0B,MAAAA,KAAK,EAAE,GAAT;AAAcG,MAAAA,MAAM,EAAE,GAAtB;AAA2BwB,MAAAA,KAAK,EAAE;AAAlC,KAAP;AACD;;AAEDpD,EAAAA,cAAc,CAACC,SAAD,EAAY;AACxB,QAAI4C,KAAK,GAAG5C,SAAS,CAAC4C,KAAV,CAAgB,8DAAhB,CAAZ;AACA,WAAOA,KAAK,IAAIA,KAAK,CAAC,CAAD,CAAL,CAASC,MAAT,KAAoB,EAA7B,GAAkCD,KAAK,CAAC,CAAD,CAAvC,GAA6C5C,SAApD;AACD;;AAEDC,EAAAA,WAAW,CAACG,OAAD,EAAU;AACnB,QAAI0C,cAAc,GAAG,KAAKnD,GAAL,CAASsB,EAAT,CAAYC,KAAZ,CAAkBC,UAAlB,CAA6Bf,OAA7B,CAArB;AACA,QAAIgD,YAAY,GAAG,KAAKzD,GAAL,CAASsB,EAAT,CAAYC,KAAZ,CAAkBC,UAAlB,CAA6B,KAAKzB,OAAL,CAAayD,KAA1C,CAAnB;AACA,WAAQ,eAAcL,cAAe,UAASM,YAAa,EAA3D;AACD;;AAfwC;;ACP3C;AACA;AAMA,MAAMC,YAAN,SAA2B9D,gBAA3B,CAA4C;AAE1CO,EAAAA,iBAAiB,GAAG;AAClB,WAAO;AAAE0B,MAAAA,KAAK,EAAE,GAAT;AAAcG,MAAAA,MAAM,EAAE;AAAtB,KAAP;AACD;;AAED5B,EAAAA,cAAc,CAACC,SAAD,EAAY;AACxB,QAAI4C,KAAK,GAAG5C,SAAS,CAAC4C,KAAV,CAAgB,gCAAhB,CAAZ;AACA,WAAOA,KAAK,GAAGA,KAAK,CAAC,CAAD,CAAR,GAAc5C,SAA1B;AACD;;AAEDC,EAAAA,WAAW,CAACG,OAAD,EAAU;AACnB,QAAI0C,cAAc,GAAG,KAAKnD,GAAL,CAASsB,EAAT,CAAYC,KAAZ,CAAkBC,UAAlB,CAA6Bf,OAA7B,CAArB;AACA,WAAO,6BAA6B0C,cAA7B,GACD,8EADC,GAED,+GAFC,GAGD,0DAHN;AAID;;AAjByC;;ACP5C;AACA;AAIA,MAAMQ,cAAN,CAAqB;AAEnB9D,EAAAA,WAAW,CAACC,IAAD,EAAOC,OAAP,EAAgBC,GAAhB,EAAqB;AAC9B,SAAKF,IAAL,GAAYA,IAAZ;AACA,SAAKC,OAAL,GAAeE,MAAM,CAACC,MAAP,CAAc,KAAKC,iBAAL,EAAd,EAAwCJ,OAAxC,CAAf;AACA,SAAKC,GAAL,GAAWA,GAAX;AACD;;AACDG,EAAAA,iBAAiB,GAAG;AAClB,WAAO;AAAE,mBAAa,IAAf;AAAqByD,MAAAA,GAAG,EAAE;AAA1B,KAAP;AACD;;AAGD/C,EAAAA,YAAY,CAACJ,OAAD,EAAUK,mBAAV,EAA+Bf,OAAO,GAAG,EAAzC,EAA6C;AACvD,QAAIgB,mBAAmB,GAAG,EAA1B;;AACA,QAAI,KAAKf,GAAL,CAASD,OAAT,CAAiBiB,kBAArB,EAAyC;AACvCD,MAAAA,mBAAmB,CAACE,IAApB,CAAyB,KAAKjB,GAAL,CAASD,OAAT,CAAiBiB,kBAA1C;AACD;;AACD,QAAIK,kBAAkB,GAAG,KAAKrB,GAAL,CAASsB,EAAT,CAAYC,KAAZ,CAAkBC,UAAlB,CAA6B,KAAK1B,IAAlC,CAAzB;AACAiB,IAAAA,mBAAmB,CAACE,IAApB,CAAyB,KAAKjB,GAAL,CAASD,OAAT,CAAiB0B,kBAAjB,GAAsCJ,kBAA/D;AAEA,QAAIK,mBAAmB,GAAG,EAA1B,CARuD;;AAUvD,UAAMa,eAAe,GAAGtC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB,KAAKH,OAAvB,EAAgCA,OAAhC,CAAxB,CAVuD;;AAYvDE,IAAAA,MAAM,CAACuC,OAAP,CAAeD,eAAf,EAAgCE,OAAhC,CAAwCC,EAAE,IAAI;AAC5ChB,MAAAA,mBAAmB,CAACT,IAApB,CAAyByB,EAAzB;;AACA,UAAIA,EAAE,CAAC,CAAD,CAAF,KAAU,OAAd,EAAuB;AACrB3B,QAAAA,mBAAmB,CAACE,IAApB,CAAyByB,EAAE,CAAC,CAAD,CAA3B;AACD;AACF,KALD;AAOA,QAAIC,gBAAgB,GAAGjB,mBAAmB,CACvCkB,GADoB,CAChBC,IAAI,IACPA,IAAI,CAAC,CAAD,CAAJ,KAAYX,SAAZ,GACK,GAAEW,IAAI,CAAC,CAAD,CAAI,KAAIA,IAAI,CAAC,CAAD,CAAI,GAD3B,GAEIA,IAAI,CAAC,CAAD,CAJW,EAMpBC,IANoB,CAMf,GANe,CAAvB;AAQA,WAAQ,eAAc/B,mBAAmB,CAAC+B,IAApB,CAAyB,GAAzB,CAA8B,IAA7C,GACF,qCAAoCH,gBAAiB,aAAYJ,eAAe,CAAC,WAAD,CAAc,UAASA,eAAe,CAACqB,GAAI,cAAanD,OAAQ,yBAD9I,GAEH,UAFJ;AAGD;;AA1CkB;;ACLrB;AACA;AAIA,MAAMoD,eAAN,CAAsB;AAEpBhE,EAAAA,WAAW,CAACC,IAAD,EAAOC,OAAP,EAAgBC,GAAhB,EAAqB;AAC9B,SAAKF,IAAL,GAAYA,IAAZ;AAEA,SAAKE,GAAL,GAAWA,GAAX;AACA,SAAKD,OAAL,GAAeE,MAAM,CAACC,MAAP,CAAc,KAAKC,iBAAL,EAAd,EAAwCJ,OAAxC,CAAf;AACD;;AAEDI,EAAAA,iBAAiB,GAAG;AAClB,WAAO;AAAE0B,MAAAA,KAAK,EAAE,GAAT;AAAcG,MAAAA,MAAM,EAAE;AAAtB,KAAP;AACD;;AAEDnB,EAAAA,YAAY,CAACJ,OAAD,EAAUK,mBAAV,EAA+Bf,OAAO,GAAG,EAAzC,EAA6C;AAEvD,QAAIgB,mBAAmB,GAAG,EAA1B;;AACA,QAAI,KAAKf,GAAL,CAASD,OAAT,CAAiBiB,kBAArB,EAAyC;AACvCD,MAAAA,mBAAmB,CAACE,IAApB,CAAyB,KAAKjB,GAAL,CAASD,OAAT,CAAiBiB,kBAA1C;AACD;;AACD,QAAIK,kBAAkB,GAAG,KAAKrB,GAAL,CAASsB,EAAT,CAAYC,KAAZ,CAAkBC,UAAlB,CAA6B,KAAK1B,IAAlC,CAAzB;AACAiB,IAAAA,mBAAmB,CAACE,IAApB,CAAyB,KAAKjB,GAAL,CAASD,OAAT,CAAiB0B,kBAAjB,GAAsCJ,kBAA/D;AAEA,QAAIK,mBAAmB,GAAG,EAA1B;AACAA,IAAAA,mBAAmB,CAACT,IAApB,CAAyB,CAAE,KAAF,EAAS,oDAAoDZ,SAA7D,CAAzB;AAEA,UAAMkC,eAAe,GAAGtC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB,KAAKH,OAAvB,EAAgCA,OAAhC,CAAxB,CAZuD;;AAcvDE,IAAAA,MAAM,CAACuC,OAAP,CAAeD,eAAf,EAAgCE,OAAhC,CAAwCC,EAAE,IAAI;AAC5ChB,MAAAA,mBAAmB,CAACT,IAApB,CAAyByB,EAAzB;;AACA,UAAIA,EAAE,CAAC,CAAD,CAAF,KAAU,OAAd,EAAuB;AACrB3B,QAAAA,mBAAmB,CAACE,IAApB,CAAyByB,EAAE,CAAC,CAAD,CAA3B;AACD;AACF,KALD;AAOA,QAAIC,gBAAgB,GAAGjB,mBAAmB,CACvCkB,GADoB,CAChBC,IAAI,IACPA,IAAI,CAAC,CAAD,CAAJ,KAAYX,SAAZ,GACK,GAAEW,IAAI,CAAC,CAAD,CAAI,KAAIA,IAAI,CAAC,CAAD,CAAI,GAD3B,GAEIA,IAAI,CAAC,CAAD,CAJW,EAMpBC,IANoB,CAMf,GANe,CAAvB;AAQA,WAAQ,eAAc/B,mBAAmB,CAAC+B,IAApB,CAAyB,GAAzB,CAA8B,IAA7C,GACF,WAAUH,gBAAiB,YADzB,GAEH,UAFJ;AAGD;;AA7CmB;;ACLtB;AACA;AAIA,MAAMmB,cAAN,CAAqB;AAEnBjE,EAAAA,WAAW,CAACC,IAAD,EAAOC,OAAP,EAAgBC,GAAhB,EAAqB;AAC9B,SAAKF,IAAL,GAAYA,IAAZ;AAEA,SAAKE,GAAL,GAAWA,GAAX;AACA,SAAKD,OAAL,GAAeE,MAAM,CAACC,MAAP,CAAc,KAAKC,iBAAL,EAAd,EAAwCJ,OAAxC,CAAf;AACD;;AACDI,EAAAA,iBAAiB,GAAG;AAClB,WAAO,EAAP;AACD;;AAGDU,EAAAA,YAAY,CAACJ,OAAD,EAAUK,mBAAV,EAA+Bf,OAAO,GAAG,EAAzC,EAA6C;AAEvD,QAAIgB,mBAAmB,GAAG,EAA1B;;AACA,QAAI,KAAKf,GAAL,CAASD,OAAT,CAAiBiB,kBAArB,EAAyC;AACvCD,MAAAA,mBAAmB,CAACE,IAApB,CAAyB,KAAKjB,GAAL,CAASD,OAAT,CAAiBiB,kBAA1C;AACD;;AACD,QAAIK,kBAAkB,GAAG,KAAKrB,GAAL,CAASsB,EAAT,CAAYC,KAAZ,CAAkBC,UAAlB,CAA6B,KAAK1B,IAAlC,CAAzB;AACAiB,IAAAA,mBAAmB,CAACE,IAApB,CAAyB,KAAKjB,GAAL,CAASD,OAAT,CAAiB0B,kBAAjB,GAAsCJ,kBAA/D;AAEA,QAAIK,mBAAmB,GAAG,EAA1B,CATuD;;AAYvD,UAAMa,eAAe,GAAGtC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB,KAAKH,OAAvB,EAAgCA,OAAhC,CAAxB,CAZuD;;AAcvDE,IAAAA,MAAM,CAACuC,OAAP,CAAeD,eAAf,EAAgCE,OAAhC,CAAwCC,EAAE,IAAI;AAC5ChB,MAAAA,mBAAmB,CAACT,IAApB,CAAyByB,EAAzB;AAED,KAHD;AAKA,QAAIC,gBAAgB,GAAGjB,mBAAmB,CACvCkB,GADoB,CAChBC,IAAI,IACPA,IAAI,CAAC,CAAD,CAAJ,KAAYX,SAAZ,GACK,GAAEW,IAAI,CAAC,CAAD,CAAI,KAAIA,IAAI,CAAC,CAAD,CAAI,GAD3B,GAEIA,IAAI,CAAC,CAAD,CAJW,EAMpBC,IANoB,CAMf,GANe,CAAvB;AAQA,WAAQ,eAAc/B,mBAAmB,CAAC+B,IAApB,CAAyB,GAAzB,CAA8B,IAA7C,GACF,eAAcrC,OAAQ,IAAGkC,gBAAiB,aADxC,GAEH,UAFJ;AAGD;;AA3CkB;;ACLrB;AACA;AAIA,MAAMoB,YAAN,CAAmB;AAEjBlE,EAAAA,WAAW,CAACC,IAAD,EAAOC,OAAP,EAAgBC,GAAhB,EAAqB;AAC9B,SAAKF,IAAL,GAAYA,IAAZ;AAEA,SAAKE,GAAL,GAAWA,GAAX;AACA,SAAKD,OAAL,GAAeE,MAAM,CAACC,MAAP,CAAc,KAAKC,iBAAL,EAAd,EAAwCJ,OAAxC,CAAf;AACD;;AACDI,EAAAA,iBAAiB,GAAG;AAClB,WAAO,EAAP;AACD;;AAGDU,EAAAA,YAAY,CAACJ,OAAD,EAAUK,mBAAV,EAA+Bf,OAAO,GAAG,EAAzC,EAA6C;AAEvD,QAAIgB,mBAAmB,GAAG,EAA1B;;AACA,QAAI,KAAKf,GAAL,CAASD,OAAT,CAAiBiB,kBAArB,EAAyC;AACvCD,MAAAA,mBAAmB,CAACE,IAApB,CAAyB,KAAKjB,GAAL,CAASD,OAAT,CAAiBiB,kBAA1C;AACD;;AACD,QAAIK,kBAAkB,GAAG,KAAKrB,GAAL,CAASsB,EAAT,CAAYC,KAAZ,CAAkBC,UAAlB,CAA6B,KAAK1B,IAAlC,CAAzB;AACAiB,IAAAA,mBAAmB,CAACE,IAApB,CAAyB,KAAKjB,GAAL,CAASD,OAAT,CAAiB0B,kBAAjB,GAAsCJ,kBAA/D;AAEA,QAAIK,mBAAmB,GAAG,EAA1B,CATuD;;AAYvD,UAAMa,eAAe,GAAGtC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB,KAAKH,OAAvB,EAAgCA,OAAhC,CAAxB,CAZuD;;AAcvDE,IAAAA,MAAM,CAACuC,OAAP,CAAeD,eAAf,EAAgCE,OAAhC,CAAwCC,EAAE,IAAI;AAC5ChB,MAAAA,mBAAmB,CAACT,IAApB,CAAyByB,EAAzB;;AACA,UAAIA,EAAE,CAAC,CAAD,CAAF,KAAU,OAAd,EAAuB;AACrB3B,QAAAA,mBAAmB,CAACE,IAApB,CAAyByB,EAAE,CAAC,CAAD,CAA3B;AACD;AACF,KALD;AAOA,QAAIC,gBAAgB,GAAGjB,mBAAmB,CACvCkB,GADoB,CAChBC,IAAI,IACPA,IAAI,CAAC,CAAD,CAAJ,KAAYX,SAAZ,GACK,GAAEW,IAAI,CAAC,CAAD,CAAI,KAAIA,IAAI,CAAC,CAAD,CAAI,GAD3B,GAEIA,IAAI,CAAC,CAAD,CAJW,EAMpBC,IANoB,CAMf,GANe,CAAvB;AAQA,WAAQ,eAAc/B,mBAAmB,CAAC+B,IAApB,CAAyB,GAAzB,CAA8B,IAA7C,GACF,aAAYrC,OAAQ,IAAGkC,gBAAiB,WADtC,GAEH,UAFJ;AAGD;;AA7CgB;;ACLnB;AACA;AAWA,MAAMqB,iBAAN,CAAwB;AAEtBnE,EAAAA,WAAW,CAACyB,EAAD,EAAKvB,OAAL,EAAc;AACvB,SAAKuB,EAAL,GAAUA,EAAV;AACA,SAAKvB,OAAL,GAAeE,MAAM,CAACC,MAAP,CAAc,KAAKC,iBAAL,EAAd,EAAwCJ,OAAxC,CAAf;;AAEA,SAAKkE,aAAL;AACD;;AAEDA,EAAAA,aAAa,GAAG;AACd,QAAIC,sBAAsB,GAAG;AAC3BC,MAAAA,OAAO,EAAEnB,cADkB;AAE3BoB,MAAAA,KAAK,EAAEhB,YAFoB;AAG3BiB,MAAAA,IAAI,EAAEd,WAHqB;AAI3Be,MAAAA,KAAK,EAAEZ,YAJoB;AAK3Ba,MAAAA,OAAO,EAAEZ,cALkB;AAM3Ba,MAAAA,QAAQ,EAAEX,eANiB;AAO3BY,MAAAA,OAAO,EAAEX,cAPkB;AAQ3BY,MAAAA,KAAK,EAAEX;AARoB,KAA7B;AAWA,QAAIY,eAAe,GAAG1E,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBgE,sBAAlB,EAA0C,KAAKnE,OAAL,CAAa6E,QAAvD,CAAtB;AACA,QAAIA,QAAQ,GAAG,EAAf;;AACA,SAAK,IAAIC,WAAT,IAAwB5E,MAAM,CAAC6E,IAAP,CAAYH,eAAZ,CAAxB,EAAsD;AACpD,UAAII,aAAa,GAAGJ,eAAe,CAACE,WAAD,CAAnC;AACAD,MAAAA,QAAQ,CAACC,WAAD,CAAR,GAAwB,IAAIE,aAAJ,CAAkBF,WAAlB,EAA+B,KAAK9E,OAAL,CAAa8E,WAAb,CAA/B,EAA0D,IAA1D,CAAxB;AACD;;AAED,SAAKD,QAAL,GAAgBA,QAAhB;AACD;;AAEDzE,EAAAA,iBAAiB,GAAG;AAClB,WAAO;AACLa,MAAAA,kBAAkB,EAAE,aADf;AAELS,MAAAA,kBAAkB,EAAE,sBAFf;AAGLQ,MAAAA,gBAAgB,EAAE,IAHb;AAILE,MAAAA,uBAAuB,EAAE,KAJpB;AAKL6C,MAAAA,iCAAiC,EAAE,KAL9B;AAML1C,MAAAA,eAAe,EAAE,IANZ;AAOL3B,MAAAA,SAAS,EAAE;AAPN,KAAP;AASD;;AAzCqB;;ACZxB;AACA;AAEA;AACA,SAASsE,QAAT,CAAkBC,MAAlB,EAA0BC,GAA1B,EAA+BpF,OAAO,GAAG,EAAzC,EAA6CqF,IAA7C,EAAmD;AACjD,MAAIC,UAAU,GAAGH,MAAM,CAACC,GAAD,CAAvB;AAEA,MAAIG,OAAO,GAAGD,UAAU,CAACE,IAAX,CAAgBD,OAA9B;AACA,MAAI7E,OAAO,GAAG4E,UAAU,CAACE,IAAX,CAAgB9E,OAA9B;AACA,MAAIK,mBAAmB,GAAGuE,UAAU,CAACE,IAAX,CAAgBzE,mBAA1C;AAEA,MAAI0E,aAAa,GAAGH,UAAU,CAACE,IAAX,CAAgBE,cAApC;AAEA,SAAOH,OAAO,CAACzE,YAAR,CAAqBJ,OAArB,EAA8BK,mBAA9B,EAAmD0E,aAAnD,CAAP;AACD;;ACdD;AACA;AAEA,MAAME,YAAY,GAAG,QAAQC,KAAR,CAAc,EAAd,CAArB;AACA,MAAMC,YAAY,GAAGF,YAAY,CAAC9C,GAAb,CAAiBiD,IAAI,IAAIA,IAAI,CAACC,UAAL,CAAgB,CAAhB,CAAzB,CAArB;;AAGA,SAASC,eAAT,CAAyBC,KAAzB,EAAgCC,OAAhC,EAAyCC,MAAzC,EAAiDC,OAAjD,EAA0D;AACxD,MAAIC,MAAM,GAAG,IAAb;AACA,MAAIC,UAAU,GAAGF,OAAO,CAACG,IAAzB;AACA,MAAIC,WAAW,GAAGP,KAAK,CAACQ,GAAN,CAAUC,OAAV,CAAkBP,MAAlB,EAA0BC,OAAO,CAACO,GAAlC,CAAlB;AAEA,MAAIH,WAAW,KAAK,CAAC,CAArB,EAAwB,OAAO,KAAP;AAExBH,EAAAA,MAAM,GAAGJ,KAAK,CAACW,MAAN,CAAaR,OAAO,CAACG,IAArB,CAAT;;AACA,SAAOC,WAAW,IAAIH,MAAtB,EAA8B;AAC5B,MAAEC,UAAF;AACAD,IAAAA,MAAM,GAAGJ,KAAK,CAACW,MAAN,CAAaN,UAAb,CAAT;AAEA,QAAIA,UAAU,IAAIJ,OAAlB,EAA2B,OAAO,KAAP;AAC5B;;AAEDE,EAAAA,OAAO,CAACS,OAAR,GAAkBT,OAAO,CAACO,GAA1B;AACAP,EAAAA,OAAO,CAACO,GAAR,GAAcH,WAAd;AACAJ,EAAAA,OAAO,CAACG,IAAR,GAAeD,UAAf;AACA,SAAO,IAAP;AACD;;AAGD,SAASQ,SAAT,CAAmBb,KAAnB,EAA0Bc,SAA1B,EAAqCb,OAArC,EAA8Cc,MAA9C,EAAsD;AACpD,MAAIC,QAAQ,GAAGhB,KAAK,CAACiB,MAAN,CAAaH,SAAb,IAA0Bd,KAAK,CAACkB,MAAN,CAAaJ,SAAb,CAAzC;AACA,MAAIV,MAAM,GAAGJ,KAAK,CAACW,MAAN,CAAaG,SAAb,CAAb;AAEA,MAAIX,OAAO,GAAG;AAAEG,IAAAA,IAAI,EAAEQ,SAAR;AAAmBJ,IAAAA,GAAG,EAAEM;AAAxB,GAAd,CAJoD;;AAOpD,MAAIF,SAAS,KAAK,CAAlB,EAAqB;AACnB,QAAIK,gBAAgB,GAAGnB,KAAK,CAACiB,MAAN,CAAaH,SAAS,GAAG,CAAzB,IAA8Bd,KAAK,CAACkB,MAAN,CAAaJ,SAAS,GAAG,CAAzB,CAArD;AACA,QAAIM,cAAc,GAAGpB,KAAK,CAACW,MAAN,CAAaG,SAAS,GAAG,CAAzB,CAArB;AACA,QAAIM,cAAc,GAAGD,gBAArB,EAAuC,OAAO,KAAP;AACxC,GAXmD;;;AAcpD,MAAIf,MAAM,GAAGY,QAAT,GAAoB,CAAxB,EAA2B,OAAO,KAAP;AAC3B,MAAIpB,YAAY,CAAC,CAAD,CAAZ,KAAoBI,KAAK,CAACQ,GAAN,CAAUV,UAAV,CAAqBK,OAAO,CAACO,GAAR,EAArB,CAAxB,EAA6D,OAAO,KAAP,CAfT;;AAkBpD,MAAId,YAAY,CAAC,CAAD,CAAZ,KAAoBI,KAAK,CAACQ,GAAN,CAAUV,UAAV,CAAqBK,OAAO,CAACO,GAAR,EAArB,CAAxB,EAA6D,OAAO,KAAP;AAC7D,MAAI,CAACX,eAAe,CAACC,KAAD,EAAQC,OAAR,EAAiB,GAAjB,EAAsBE,OAAtB,CAApB,EAAoD,OAAO,KAAP;AAEpD,MAAIkB,SAAS,GAAGrB,KAAK,CAACQ,GAAN,CACbc,MADa,CACNnB,OAAO,CAACS,OADF,EACWT,OAAO,CAACO,GAAR,GAAcP,OAAO,CAACS,OADjC,EAEbW,IAFa,GAGbC,WAHa,EAAhB;AAIA,MAAIC,CAAJ;AACA,MAAIC,UAAU,GAAG,EAAjB;AACA,MAAIC,KAAK,GAAG,sDAAZ;;AACA,SAAO,CAACF,CAAC,GAAGE,KAAK,CAACC,IAAN,CAAWP,SAAX,CAAL,MAAgC,IAAvC,EAA6C;AAC3C;AACA,QAAII,CAAC,CAACI,KAAF,KAAYF,KAAK,CAACG,SAAtB,EAAiC;AAC/BH,MAAAA,KAAK,CAACG,SAAN;AACD,KAJ0C;;;AAO3CJ,IAAAA,UAAU,CAACD,CAAC,CAAC,CAAD,CAAF,CAAV,GAAmBA,CAAC,CAAC,CAAD,CAApB;AACD;;AAED,MAAI5C,WAAW,GAAG,SAAlB;AACA8C,EAAAA,KAAK,GAAG,aAAR;;AACA,SAAO,CAACF,CAAC,GAAGE,KAAK,CAACC,IAAN,CAAWP,SAAX,CAAL,MAAgC,IAAvC,EAA6C;AAC3C;AACA,QAAII,CAAC,CAACI,KAAF,KAAYF,KAAK,CAACG,SAAtB,EAAiC;AAC/BH,MAAAA,KAAK,CAACG,SAAN;AACD,KAJ0C;;;AAO3CjD,IAAAA,WAAW,GAAG4C,CAAC,CAAC,CAAD,CAAf;AACD;;AAED,IAAEtB,OAAO,CAACO,GAAV,CAlDoD;;AAqDpD,MAAIpB,OAAO,GAAG,KAAKV,QAAL,CAAcC,WAAd,CAAd,CArDoD;;AAuDpD,MAAI,CAACS,OAAL,EAAc,OAAO,KAAP,CAvDsC;;AA0DpD,MAAIM,YAAY,CAAC,CAAD,CAAZ,KAAoBI,KAAK,CAACQ,GAAN,CAAUV,UAAV,CAAqBK,OAAO,CAACO,GAAR,EAArB,CAAxB,EAA6D,OAAO,KAAP;AAC7D,MAAI,CAACX,eAAe,CAACC,KAAD,EAAQC,OAAR,EAAiB,GAAjB,EAAsBE,OAAtB,CAApB,EAAoD,OAAO,KAAP;AAEpD,MAAI4B,cAAc,GAAG/B,KAAK,CAACQ,GAAN,CAClBc,MADkB,CACXnB,OAAO,CAACS,OADG,EACMT,OAAO,CAACO,GAAR,GAAcP,OAAO,CAACS,OAD5B,EAElBW,IAFkB,EAArB;AAIA,IAAEpB,OAAO,CAACO,GAAV,CAjEoD;;AAoEpDN,EAAAA,MAAM,GAAGJ,KAAK,CAACW,MAAN,CAAaR,OAAO,CAACG,IAArB,CAAT;AACA,MAAI0B,YAAY,GAAGhC,KAAK,CAACQ,GAAN,CAChBc,MADgB,CACTnB,OAAO,CAACO,GADC,EACIN,MAAM,GAAGD,OAAO,CAACO,GADrB,EAEhBa,IAFgB,EAAnB;AAGA,MAAIS,YAAY,KAAK,EAArB,EAAyB,OAAO,KAAP,CAxE2B;;AA2EpD,MAAI/B,OAAO,KAAKE,OAAO,CAACG,IAAR,GAAe,CAA/B,EAAkC;AAChC,QAAI2B,gBAAgB,GAAGjC,KAAK,CAACiB,MAAN,CAAad,OAAO,CAACG,IAAR,GAAe,CAA5B,IAAiCN,KAAK,CAACkB,MAAN,CAAaf,OAAO,CAACG,IAAR,GAAe,CAA5B,CAAxD;AACA,QAAI4B,cAAc,GAAGlC,KAAK,CAACW,MAAN,CAAaR,OAAO,CAACG,IAAR,GAAe,CAA5B,CAArB;AACA,QAAI4B,cAAc,GAAGD,gBAArB,EAAuC,OAAO,KAAP;AACxC;;AAED,MAAI9B,OAAO,CAACG,IAAR,IAAgBL,OAApB,EAA6B,OAAO,KAAP;;AAE7B,MAAI,CAACc,MAAL,EAAa;AACX,QAAIoB,KAAK,GAAGnC,KAAK,CAAC/E,IAAN,CAAW,OAAX,EAAoB,KAApB,EAA2B,CAA3B,CAAZ,CADW;;AAGX,QAAIH,mBAAmB,GAAG,EAA1B,CAHW;;AAKX,QAAI,KAAKf,OAAL,CAAaiF,iCAAb,KAAmD,IAAvD,EAA6D;AAC3D,YAAMoD,wBAAwB,GAAGL,cAAc,CAACpC,KAAf,CAAqB,IAArB,CAAjC;;AACA,UAAIyC,wBAAwB,CAAClF,MAAzB,GAAkC,CAAtC,EAAyC;AACvC;AACA6E,QAAAA,cAAc,GAAGK,wBAAwB,CAAC,CAAD,CAAzC,CAFuC;AAIvC;AACA;;AACA,cAAMC,yBAAyB,GAAGD,wBAAwB,CAAC,CAAD,CAAxB,CAA4BzC,KAA5B,CAAkC,GAAlC,CAAlC;;AACA,YAAI0C,yBAAyB,CAACnF,MAA1B,KAAqC,CAAzC,EAA4C;AAC1C;AACApC,UAAAA,mBAAmB,CAACc,KAApB,GAA4ByG,yBAAyB,CAAC,CAAD,CAArD;AACAvH,UAAAA,mBAAmB,CAACiB,MAApB,GAA6BsG,yBAAyB,CAAC,CAAD,CAAtD;AACD,SAJD,MAIO,IAAIA,yBAAyB,CAACnF,MAA1B,KAAqC,CAAzC,EAA4C;AACjD;AACApC,UAAAA,mBAAmB,CAACuB,WAApB,GAAkCgG,yBAAyB,CAAC,CAAD,CAA3D;AACD,SAdsC;;AAgBxC;AACF;;AACDF,IAAAA,KAAK,CAACG,MAAN,GAAetC,KAAK,CAACQ,GAAN,CAAU+B,KAAV,CAAgBvB,QAAhB,EAA0Bb,OAAO,CAACO,GAAlC,CAAf;AACAyB,IAAAA,KAAK,CAACK,KAAN,GAAc,IAAd;AACAL,IAAAA,KAAK,CAAC5C,IAAN,GAAa;AACXV,MAAAA,WAAW,EAAEA,WADF;AAEXS,MAAAA,OAAO,EAAEA,OAFE;AAGXyC,MAAAA,cAAc,EAAEA,cAHL;AAIXtC,MAAAA,cAAc,EAAEiC,UAJL;AAKXjH,MAAAA,OAAO,EAAE6E,OAAO,CAAClF,cAAR,CAAuB2H,cAAvB,CALE;AAMXjH,MAAAA,mBAAmB,EAAEA;AANV,KAAb;AAQAqH,IAAAA,KAAK,CAACvF,GAAN,GAAY,CAAEkE,SAAF,EAAaX,OAAO,CAACG,IAAR,GAAe,CAA5B,CAAZ;AAEAN,IAAAA,KAAK,CAACM,IAAN,GAAaH,OAAO,CAACG,IAAR,GAAe,CAA5B;AACD;;AAED,SAAO,IAAP;AACD;;ACzJD;AACA;AAOA,SAASmC,KAAT,CAAenH,EAAf,EAAmBvB,OAAnB,EAA4B;AAC1B,MAAIC,GAAG,GAAG,IAAIgE,iBAAJ,CAAsB1C,EAAtB,EAA0BvB,OAA1B,CAAV;AAEAuB,EAAAA,EAAE,CAACkH,KAAH,CAASE,KAAT,CAAeC,MAAf,CAAsB,OAAtB,EAA+B,OAA/B,EAAwC9B,SAAS,CAAC+B,IAAV,CAAe5I,GAAf,CAAxC,EAA6D;AAC3D6I,IAAAA,GAAG,EAAE,CAAE,WAAF,EAAe,WAAf,EAA4B,YAA5B,EAA0C,MAA1C;AADsD,GAA7D;AAGAvH,EAAAA,EAAE,CAAC2D,QAAH,CAAY6D,KAAZ,CAAkBtF,KAAlB,GAA0ByB,QAAQ,CAAC2D,IAAT,CAAc5I,GAAd,CAA1B;AACD;;;;"}